# 受试者端功能说明

## 概述
受试者端（Participant Portal）已完成开发，为临床试验的潜在参与者提供了完整的报名和管理功能。

## 已实现的功能模块

### 1. 受试者首页 (`/participant`)
- **功能**：系统入口页面，展示系统功能简介
- **展示内容**：
  - 当前可报名的临床试验数量
  - 我的报名记录数量
  - 系统功能简介（浏览试验、在线报名、查看状态）
- **快捷入口**：
  - 查看临床试验
  - 查看我的报名

### 2. 临床试验列表 (`/participant/trials`)
- **功能**：展示所有招募中的临床试验
- **展示信息**：
  - 试验名称和描述
  - 年龄范围
  - 性别要求
  - 试验类型
  - 持续时间
  - 已报名标识
- **操作**：查看详情并报名

### 3. 临床试验详情与报名 (`/participant/trials/{id}`)
- **功能**：查看试验详细信息并提交报名申请
- **左侧展示**：
  - 试验基本信息
  - 招募条件
  - 排除条件
  - 研究机构等
- **右侧报名表单**：
  - 年龄（只读，从个人信息读取）
  - 性别（只读）
  - 健康状况描述（必填）
  - 既往病史（选填）
- **智能匹配**：提交后自动计算匹配分数
- **状态检查**：如已报名则显示报名状态

### 4. 我的报名 (`/participant/my-applications`)
- **功能**：查看所有报名记录和审核状态
- **展示信息**：
  - 临床试验名称
  - 报名时间
  - 当前状态（待审核/已批准/已拒绝/已入组/人工复核）
- **状态说明**：
  - 待审核：申请已提交，等待审核
  - 人工复核：需要研究人员进一步评估
  - 已批准：申请通过，等待入组
  - 已入组：成功入组临床试验
  - 已拒绝：申请未通过审核

### 5. 个人信息 (`/participant/profile`)
- **功能**：维护个人基础信息
- **可编辑字段**：
  - 年龄
  - 性别
  - 健康状况描述
  - 既往病史
- **只读字段**：
  - 用户名
  - 邮箱
- **信息说明**：
  - 信息准确性影响匹配结果
  - 个人信息严格保密
  - 修改后可能影响已提交申请

## 技术实现

### 控制器
- **ParticipantController**：处理所有受试者端请求
  - 首页展示
  - 临床试验列表和详情
  - 报名申请提交
  - 我的报名查询
  - 个人信息更新

### 服务层
- **EnrollmentService**：新增方法
  - `getApplicationsByUserId()` - 根据用户ID获取申请列表
  - `getApplicationByUserAndTrial()` - 检查是否已报名
- **ClinicalTrialService**：使用现有方法
  - `getActiveTrials()` - 获取招募中的试验
  - `getTrialById()` - 获取试验详情
- **MatchingService**：自动计算匹配分数
  - 报名时自动调用智能匹配算法

### 页面模板
1. `participant/home.html` - 受试者首页
2. `participant/trials.html` - 临床试验列表
3. `participant/trial-detail.html` - 试验详情和报名
4. `participant/my-applications.html` - 我的报名
5. `participant/profile.html` - 个人信息
6. `fragments/participant-sidebar.html` - 受试者侧边栏

### 权限配置
- **角色**：PARTICIPANT
- **访问路径**：`/participant/**`
- **登录后重定向**：`/participant`

## 业务规则

1. **报名限制**：
   - 每个临床试验只能报名一次
   - 必须填写健康状况描述
   - 年龄和性别从个人信息读取

2. **智能匹配**：
   - 报名时自动计算匹配分数（0-100分）
   - 基于年龄、性别、健康状况等因素
   - 匹配分数存储在申请记录中

3. **状态流转**：
   - PENDING（待审核）→ APPROVED（已批准）→ ENROLLED（已入组）
   - PENDING（待审核）→ REJECTED（已拒绝）
   - PENDING（待审核）→ MANUAL_REVIEW（人工复核）

4. **信息保护**：
   - 受试者无法查看匹配分数细节
   - 不展示系统内部管理信息
   - 仅显示与自身相关的数据

## 使用流程

1. **受试者登录** → 进入受试者首页
2. **浏览临床试验** → 查看招募中的试验列表
3. **查看试验详情** → 了解试验要求和条件
4. **填写报名信息** → 提交健康状况和病史
5. **系统智能匹配** → 自动计算匹配分数
6. **等待审核** → 研究人员审核申请
7. **查看报名状态** → 实时了解审核进展
8. **更新个人信息** → 维护准确的健康信息

## 与管理端的交互

- 受试者提交报名 → 管理端收到待审核申请
- 管理端查看智能匹配结果 → 包含受试者匹配分数
- 管理端批准/拒绝 → 受试者端状态更新
- 受试者更新信息 → 影响后续匹配结果

## 注意事项

1. 受试者端设计简洁，避免复杂操作
2. 不暴露匹配算法细节和评分标准
3. 状态更新实时反映在"我的报名"页面
4. 个人信息修改会影响智能匹配结果
5. 已报名的试验会在列表中标识

## 下一步建议

1. 添加邮件通知功能（状态变更时通知受试者）
2. 增加报名撤销功能（待审核状态下）
3. 提供试验进度跟踪（入组后的试验进展）
4. 添加常见问题解答（FAQ）页面
5. 优化移动端显示效果
