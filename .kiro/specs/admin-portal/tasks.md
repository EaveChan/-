# Implementation Plan: 系统管理员端

## Overview

本实现计划用于完善系统管理员端功能，包括系统概览页面、角色权限管理页面，以及用户管理功能的优化。

## Tasks

- [ ] 1. 创建统计服务和数据模型
  - 创建 AdminStatisticsService 服务类
  - 创建 SystemStatistics DTO 类
  - 创建 RolePermission DTO 类
  - 实现统计数据查询方法
  - _Requirements: 1.1, 1.2, 1.3_

- [ ]* 1.1 编写统计服务的单元测试
  - 测试用户统计方法
  - 测试临床试验统计方法
  - _Requirements: 1.1, 1.2, 1.3_

- [ ] 2. 实现系统概览页面
  - [ ] 2.1 在 AdminController 添加系统概览端点
    - 添加 @GetMapping("/overview") 方法
    - 调用统计服务获取数据
    - 将数据传递给视图
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [ ] 2.2 创建系统概览页面模板
    - 创建 admin/overview.html 模板
    - 使用卡片式布局展示统计数据
    - 添加快捷入口按钮
    - 使用图标和颜色区分统计项
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ]* 2.3 编写系统概览页面的集成测试
  - 测试页面数据加载
  - 测试统计数据的正确性
  - _Requirements: 1.1, 1.2, 1.3_

- [ ] 3. 实现角色权限管理页面
  - [ ] 3.1 创建角色权限配置类
    - 创建 RolePermissions 配置类
    - 定义角色与权限的映射关系
    - _Requirements: 3.1, 3.2, 3.4, 3.5_

  - [ ] 3.2 在 AdminController 添加角色权限端点
    - 添加 @GetMapping("/roles") 方法
    - 加载角色权限配置
    - 将数据传递给视图
    - _Requirements: 3.1, 3.2, 3.3_

  - [ ] 3.3 创建角色权限页面模板
    - 创建 admin/roles.html 模板
    - 使用表格展示角色与权限
    - 添加说明文字
    - 使用徽章标识角色
    - _Requirements: 3.1, 3.2, 3.3_

- [ ]* 3.4 编写角色权限配置的单元测试
  - 测试角色权限映射的完整性
  - 测试所有预置角色都有权限定义
  - _Requirements: 3.1, 3.2_

- [ ] 4. 优化用户管理功能
  - [ ] 4.1 添加用户筛选功能
    - 在 AdminController 添加角色筛选参数
    - 在用户列表页面添加角色筛选下拉框
    - 实现筛选逻辑
    - _Requirements: 4.1, 4.3_

  - [ ] 4.2 添加用户搜索功能
    - 在 AdminController 添加搜索参数
    - 在用户列表页面添加搜索输入框
    - 实现搜索逻辑
    - _Requirements: 4.2, 4.3_

- [ ]* 4.3 编写用户筛选和搜索的单元测试
  - 测试角色筛选功能
  - 测试用户名搜索功能
  - 测试筛选和搜索的组合使用
  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 5. 更新导航和路由
  - [ ] 5.1 更新侧边栏菜单
    - 在 sidebar.html 添加"系统概览"菜单项
    - 在 sidebar.html 添加"角色权限"菜单项
    - 调整菜单顺序
    - _Requirements: 6.2_

  - [ ] 5.2 配置默认首页
    - 配置系统管理员登录后跳转到系统概览
    - 更新 SecurityConfig 或登录成功处理器
    - _Requirements: 6.1_

- [ ] 6. 完善错误处理和用户体验
  - [ ] 6.1 添加操作提示消息
    - 确保所有操作都有成功/失败提示
    - 统一消息样式
    - _Requirements: 6.4, 6.5_

  - [ ] 6.2 优化页面布局
    - 确保所有页面使用一致的布局
    - 优化表格和按钮的显示
    - 添加面包屑导航
    - _Requirements: 6.3_

- [ ] 7. 最终测试和验证
  - 测试所有页面的访问权限
  - 测试用户管理的完整流程
  - 测试统计数据的准确性
  - 测试导航和路由的正确性
  - _Requirements: 所有需求_

## Notes

- 任务标记 `*` 的为可选测试任务，可根据时间安排决定是否实现
- 每个任务都引用了具体的需求编号，便于追溯
- 建议按顺序执行任务，确保依赖关系正确
- 系统概览页面是系统管理员端的核心入口，优先实现
